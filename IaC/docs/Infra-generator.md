# AWS IaC Generator

Generate CloudFormation templates using AWS IaC Generator for the three-tier architecture.

https://github.com/user-attachments/assets/615fa152-35ad-4d1a-86e9-b0cad31c2df3

## Overview

AWS IaC Generator is a tool that helps create CloudFormation templates from existing AWS resources or architectural patterns.

## Installation

```bash
# Install via npm
npm install -g @aws/iac-generator

# Or use npx
npx @aws/iac-generator
```

## Usage

### Generate from Existing Resources
```bash
# Scan existing AWS resources
iac-generator scan --region us-east-1 --output-dir ./templates

# Generate specific resource types
iac-generator scan --resource-types "AWS::EC2::VPC,AWS::EC2::Subnet" --region us-east-1
```

### Generate from Architecture Pattern
```bash
# Generate three-tier architecture
iac-generator create --pattern three-tier --output three-tier-template.yaml

# With custom parameters
iac-generator create --pattern three-tier --parameters environment=prod,region=us-east-1
```

## Configuration

Create `iac-config.json`:
```json
{
  "region": "us-east-1",
  "outputFormat": "yaml",
  "includeParameters": true,
  "generateOutputs": true,
  "resourceNaming": {
    "prefix": "ThreeTier",
    "environment": "Demo"
  }
}
```

## Generated Template Structure

```yaml
AWSTemplateFormatVersion: '2010-09-09'
Description: 'Generated by AWS IaC Generator'

Parameters:
  EnvironmentName:
    Type: String
    Default: ThreeTierDemo

Resources:
  # VPC and networking resources
  # Security groups
  # Database resources
  # Application resources

Outputs:
  # Exported values for cross-stack references
```

## Commands

| Command | Description |
|---------|-------------|
| `scan` | Generate templates from existing resources |
| `create` | Create templates from patterns |
| `validate` | Validate generated templates |
| `deploy` | Deploy templates to AWS |

## Options

```bash
# Common options
--region <region>           # AWS region
--output-dir <directory>    # Output directory
--format <yaml|json>        # Template format
--include-parameters        # Include parameter section
--generate-outputs          # Include outputs section
--dry-run                   # Preview without creating files
```

## Integration

### With AWS CLI
```bash
# Generate and deploy
iac-generator create --pattern three-tier --output template.yaml
aws cloudformation create-stack --stack-name three-tier --template-body file://template.yaml
```

### With CI/CD
```yaml
# GitHub Actions
- name: Generate IaC
  run: |
    npx @aws/iac-generator create --pattern three-tier
    aws cloudformation deploy --template-file template.yaml --stack-name three-tier
```

## Best Practices

- **Review Generated Templates**: Always validate before deployment
- **Customize Parameters**: Adjust for your environment
- **Version Control**: Store generated templates in Git
- **Test Deployments**: Use separate environments for testing

## Troubleshooting

### Common Issues
- **Permission Errors**: Ensure proper IAM permissions
- **Resource Limits**: Check AWS service quotas
- **Template Size**: Split large templates into nested stacks

### Debug Commands
```bash
# Validate template
aws cloudformation validate-template --template-body file://template.yaml

# Check generation logs
iac-generator --verbose scan --region us-east-1
```

### Code Organization
- **Separate Stacks**: One stack per tier
- **Shared Resources**: Common VPC, security groups
- **Environment Config**: Dev, staging, prod parameters
- **Modular Design**: Reusable constructs

### Development Workflow
```bash
# Development cycle
cdk diff          # Preview changes
cdk synth         # Generate CloudFormation
cdk deploy        # Deploy to AWS
cdk destroy       # Clean up resources
```

### Testing Strategy
```typescript
// Unit test example
import { Template } from 'aws-cdk-lib/assertions';
import { VpcStack } from '../lib/vpc-stack';

test('VPC Created', () => {
  const template = Template.fromStack(new VpcStack(app, 'TestStack'));
  template.hasResourceProperties('AWS::EC2::VPC', {
    CidrBlock: '10.0.0.0/16'
  });
});
```

## Deployment Commands

### CDK Deployment
```bash
# Deploy all stacks
cdk deploy --all

# Deploy specific stack
cdk deploy VpcStack

# Deploy with parameters
cdk deploy --parameters EnvironmentName=Production
```

### Terraform Deployment
```bash
# Initialize and plan
terraform init
terraform plan

# Apply changes
terraform apply

# Destroy resources
terraform destroy
```

## Integration with CI/CD

### GitHub Actions Example
```yaml
name: Deploy Infrastructure
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm install -g aws-cdk
      - run: cdk deploy --require-approval never
```

## Troubleshooting

### Common Issues
- **Bootstrap Required**: Run `cdk bootstrap` first
- **Permission Errors**: Check IAM policies
- **Resource Conflicts**: Use unique naming
- **Stack Dependencies**: Deploy in correct order

### Debugging Commands
```bash
# View generated CloudFormation
cdk synth

# Compare with deployed stack
cdk diff

# View stack events
aws cloudformation describe-stack-events --stack-name StackName
```

## Migration Strategy

### Phased Approach
1. **Start Small**: Convert simple resources first
2. **Test Thoroughly**: Validate each conversion
3. **Gradual Migration**: Move tier by tier
4. **Monitor**: Watch for issues during transition
5. **Document**: Update procedures and runbooks

This approach ensures reliable infrastructure management through code while maintaining the flexibility to adapt to changing requirements.
